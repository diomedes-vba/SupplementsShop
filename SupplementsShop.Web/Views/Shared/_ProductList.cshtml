@model CategoryProductsListModel

<div id="category-page">
    <div class="row mb-4">
        <div class="col-10">
            <h2>@Model.CategoryName</h2>
            <h5>
                @{ var firstProductNumber = Model.CurrentPage * Model.PageSize + 1; }
                @(firstProductNumber)-@(firstProductNumber + Model.Products.Count() - 1) out of @Model.TotalProducts results
            </h5>
        </div>
        <div class="col-2">
            <h6>Products per page: </h6>
            <form method="post">
                <label for="PageSize" class="form-label d-none">Page size</label>
                <select id="PageSize"
                        class="form-select form-select-sm w-auto"
                        name="PageSize"
                        asp-for="@Model.PageSize"
                        onchange="getProductsForPage(@Model.CategoryId, 0, this.value)">
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="5">5</option>
                    <option value="10">10</option>
                    <option value="20">20</option>
                </select>
            </form>
        </div>
    </div>
    
    <div class="container py-4">
        <div class="row g-4" id="product-row">
            @foreach (var product in Model.Products)
            {
                <div class="col-md-4 col-6 col-lg-3 mb-3">
                    <div class="card product-card h-100 border-0 shadow-sm">
                        <div class="overflow-hidden">
                            <img src="@product.ImageUrl" class="card-img-top img-fluid" alt="@product.Name"/>
                        </div>
                        
                        <div class="card-body d-flex flex-column">
                            <h5 class="card-title">
                                @product.Name
                            </h5>
                            
                            <div class="mt-auto d-grid gap-2">
                                <p class="card-text text-success fw-bold">
                                    @product.Price.ToString("C")
                                </p>
                                
                                <a asp-controller="Product" asp-action="Details" asp-route-slug="@product.Slug" class="btn btn-outline-primary btn-sm">
                                    View
                                </a>

                                <button class="btn btn-success btn-sm add-to-cart-btn" data-product-id="@product.Id">
                                    <i class="bi bi-cart-plus me-1"></i>
                                    Add to Cart
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>

    <nav aria-label="Products page navigation">
        <ul class="pagination pagination-lg justify-content-center">
            <!--Previous button-->
            <li class="page-item @(Model.CurrentPage == 0 ? "disabled" : "")">
                <button class="previous-page-btn page-link" asp-is-disabled="@(Model.CurrentPage <= 0)" data-current-page="@Model.CurrentPage" data-category-id="@Model.CategoryId" data-page-size="@Model.PageSize">
                    @Html.Raw("<")
                </button>
            </li>

            @if (Model.CurrentPage + 1 <= 3)
            {
                <!-- First 3 pages: show 1, 2, 3, 4, ellipsis and last page-->
                @for (int i = 1; i <= 4 && i <= Model.TotalPages; i++)
                {
                    <li class="page-item @(Model.CurrentPage == i - 1 ? "active" : "")">
                        <button class="other-page-btn page-link" data-page-number="@i" data-category-id="@Model.CategoryId" data-page-size="@Model.PageSize">
                            @i
                        </button>
                    </li>
                }
                @if (Model.TotalPages > 5)
                {
                    <li class="page-item disabled">
                        <span class="page-link">...</span>
                    </li>
                }
                @if (Model.TotalPages > 4)
                {
                    <li class="page-item">
                        <button class="other-page-btn page-link" data-page-number="@Model.TotalPages" data-category-id="@Model.CategoryId" data-page-size="@Model.PageSize">
                            @Model.TotalPages
                        </button>
                    </li>
                }
            }
            else if (Model.CurrentPage + 1 >= Model.TotalPages - 2)
            {
                <!-- Last 3 pages: show first page, ellipsis, then the last 4 pages -->
                @if (Model.TotalPages - 3 > 1)
                {
                    <li class="page-item">
                        <button class="other-page-btn page-link" data-page-number="@(1)" data-category-id="@Model.CategoryId" data-page-size="@Model.PageSize">
                            1
                        </button>
                    </li>
                }

                @if (Model.TotalPages > 5)
                {
                    <li class="page-item disabled">
                        <span class="page-link">...</span>
                    </li>
                }

                @for (int i = Model.TotalPages - 3; i <= Model.TotalPages; i++)
                {
                    <li class="page-item @(Model.CurrentPage + 1 == i ? "active" : "")">
                        <button class="other-page-btn page-link" data-page-number="@i" data-category-id="@Model.CategoryId" data-page-size="@Model.PageSize">
                            @i
                        </button>
                    </li>
                }
            }

            else
            {
                <!-- Middle pages: show first page, ellipsis, 3 pages around the current page, ellipsis, last page -->
                <li class="page-item">
                    <button class="other-page-btn page-link" data-page-number="@(1)" data-category-id="@Model.CategoryId" data-page-size="@Model.PageSize">
                        1
                    </button>
                </li>
                <li class="page-item disabled">
                    <span class="page-link">...</span>
                </li>

                @for (int i = Model.CurrentPage; i <= Model.CurrentPage + 2; i++)
                {
                    <li class="page-item @(Model.CurrentPage + 1 == i ? "active" : "")">
                        <button class="other-page-btn page-link" data-page-number="@i" data-category-id="@Model.CategoryId" data-page-size="@Model.PageSize">
                            @i
                        </button>
                    </li>
                }

                <li class="page-item disabled">
                    <span class="page-link">...</span>
                </li>

                <li class="page-item">
                    <button class="other-page-btn page-link" data-page-number="@Model.TotalPages" data-category-id="@Model.CategoryId" data-page-size="@Model.PageSize">
                        @Model.TotalPages
                    </button>
                </li>
            }

            <!-- Next button -->
            <li class="page-item @(Model.CurrentPage + 1 == Model.TotalPages ? "disabled" : "")">
                <button class="next-page-btn page-link" asp-is-disabled="@(Model.CurrentPage + 1 >= Model.TotalPages)" data-current-page="@Model.CurrentPage" data-category-id="@Model.CategoryId" data-page-size="@Model.PageSize">
                    @Html.Raw(">")
                </button>
            </li>
        </ul>
    </nav>
</div>